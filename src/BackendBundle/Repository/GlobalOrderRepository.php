<?php

namespace BackendBundle\Repository;

/**
 * GlobalOrderRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */

class GlobalOrderRepository extends \Doctrine\ORM\EntityRepository
{

	public function hasBasket ($user){
		$qb=$this->createQueryBuilder("b")
			->join("b.user", "u")
			->leftJoin("b.order_details","od")
			->where("b.open = true")
		;
		$result = $qb->getQuery()->getResult();
		if ($result) return $result[0]; else return false;
	}

	public function total_global_order($global_order_id){
        
        $qb = $this->createQueryBuilder('g')
            ->select('SUM(o.p.price * o.quantity)')
            ->join('g.order_detail', 'o')
            ->join('o.product', 'p')
            ->where ('g.id='.$global_order_id);
        
        $result= $qb->getQuery()->getSingleResult();
        
        var_dump($result);die;
        return;
    }	

}
